<!DOCTYPE html>
<html>
<head>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
        }
        code, pre {
            font-family: monospace;
        }
        h1 code,
        h2 code,
        h3 code,
        h4 code,
        h5 code,
        h6 code {
            font-size: inherit;
        }
    </style>
</head>
<body>
<div class="container">
<h1>Migrating to gist v12.0 from v11.0</h1>

<p>This file gives a quick overview of using the migration utilities provided
by the gist team to help migrate from the previous version of gist.</p>

<blockquote>
  <p>See also additional documentation in the <a href="../../docs/MajorVersionMigration.html">Major Version Migration</a>.</p>
</blockquote>

<h2>Important Remarks</h2>

<ul>
<li><p><strong>These scripts are not cumulative; you must run the migrations for each version
in sequence.</strong></p></li>
<li><p><strong>These utilities are a starting point.</strong> You should review them before running
them to make sure you approve of the actions prior to using them.</p></li>
<li><p><strong>These utilities do not handle everything</strong>, in some cases we can only warn you
about changes that were made in gist and you will need to decide how you want
to handle the changes.</p></li>
</ul>

<h2>Migration Queries</h2>

<p>All of our migration tools are SPARQL queries.</p>

<p>The following directory structure holds the migration scripts:</p>

<p><code>
.
└── queries/
    ├── action/
    │   ├── default/
    │   │   └── *.rq
    │   └── ngraphs/
    │       └── *.rq
    └── report/
        ├── README
        ├── default/
        │   ├── old_namespace/
        │   │   └── *.rq
        │   └── new_namespace/
        │       └── *.rq
        └── ngraphs/
            ├── old_namespace/
            │   └── *.rq
            └── new_namespace/
                └── *.rq
</code></p>

<p>The <code>./queries/</code> directory contains the following two directories:</p>

<ul>
<li><p><code>./queries/action/</code> : Update queries for migrating from Gist v11.0 to v12.0</p></li>
<li><p><code>./queries/report/</code> : Validation queries that return SHACL validation reports for data that does not comply with Gist v12.0</p></li>
</ul>

<p>Each of the above directories contains the following two directories:</p>

<ul>
<li><p><code>default/</code> : These queries only work on the default graph<code>*</code></p>

<blockquote>
  <p><code>*</code> the handling of these queries will be dependent upon which Triplestore you are using and how it was configured. Some Triplestores will only use
  triples in the default graph, some will use all triples in all named graphs.</p>
</blockquote></li>
<li><p><code>ngraphs/</code> : These queries only work on named graphs</p></li>
</ul>

<p>In the <code>default/</code> and <code>ngraphs/</code> directory of <code>./queries/report/</code> is two directories:</p>

<ul>
<li><p><code>./queries/report/default|ngraphs/old_namespace/</code> : Queries with the old Gist namespace</p></li>
<li><p><code>./queries/report/default|ngraphs/old_namespace/</code> : Queries with the new Gist namespace</p></li>
</ul>

<blockquote>
  <p>See also additional documentation in the file <code>./queries/report/README.html</code>.</p>
</blockquote>

<h2>Requirements</h2>

<p>These migration scripts are meant to be run using the open source <code>onto_tool</code>
program. Information about onto_tool and how to install it, is available at
<a href="https://github.com/semanticarts/ontology-toolkit">github</a>.</p>

<h2>Run on local files</h2>

<blockquote>
  <p>Note: A known limitation of <code>onto_tool</code> is that it does not support named graphs when run against local files. It does support named graphs when run against a SPARQL endpoint.</p>
</blockquote>

<ol>
<li><p>Starting in this directory, put source data files in the <code>./input/</code> directory (the sample data can be removed). See the onto_tool documentation for which file formats are supported.</p>

<blockquote>
  <p>The <code>migrate_local.yaml</code> file currently looks in the <code>./input/</code> directory for <code>*.owl</code> and <code>*.ttl</code> files. If other formats are supported and you plan to use them, you will need to update the yaml.</p>
</blockquote></li>
<li><p>Execute the following command:</p>

<p><code>shell
onto_tool bundle migrate_local.yaml
</code></p></li>
<li><p><code>onto_tool</code> will output to STDOUT, you should see something like the following (this is the output from the sample data included in the <code>./input/</code> directory):</p>

<p><code>
INFO:root:Replace inverse properties.
INFO:root:Migrate renamed terms.
INFO:root:Replace use of gist:Percentage.
INFO:root:Check for issues that should be reviewed.
WARNING:root:Verification query ./queries/report/default/new_namespace/detect_removed.rq produced non-empty results:
Focus                     Path                            Value Severity   Message
gist:Percentage           &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:Percentage referenced in da...
gist:Percentage           &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:Percentage referenced in da...
gist:Percentage           &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:Percentage referenced in da...
gist:TimeZone             &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TimeZone referenced in data...
gist:TimeZone             &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TimeZone referenced in data...
gist:TimeZone             &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TimeZone referenced in data...
gist:TimeZoneStandard     &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TimeZoneStandard referenced...
gist:TimeZoneStandard     &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TimeZoneStandard referenced...
gist:TimeZoneStandard     &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TimeZoneStandard referenced...
gist:TreatyOrganization   &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TreatyOrganization referenc...
gist:TreatyOrganization   &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TreatyOrganization referenc...
gist:TreatyOrganization   &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:TreatyOrganization referenc...
gist:hasOffsetToUniversal &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:hasOffsetToUniversal refere...
gist:hasOffsetToUniversal &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:hasOffsetToUniversal refere...
gist:hasOffsetToUniversal &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:hasOffsetToUniversal refere...
gist:usesTimeZoneStandard &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:usesTimeZoneStandard refere...
gist:usesTimeZoneStandard &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:usesTimeZoneStandard refere...
gist:usesTimeZoneStandard &lt;urn:constraint:removed-entity&gt;       sh:Warning Removed entity gist:usesTimeZoneStandard refere...
</code></p>

<ul>
<li><p>Output files will be created in the <code>./output/</code> directory.</p></li>
<li><p>Report files will be created in the <code>./reports/</code> directory.</p></li>
</ul></li>
</ol>

<h2>Run Against SPARQL Endpoint</h2>

<p>You will need to tell <code>onto_tool</code> the URL of your SPARQL endpoint. You can do that
by editing the <code>migration_endpoint.yaml</code> file, or you can put it into the command
line execution like this:</p>

<blockquote>
  <p>Note: Use your own values in place of <code>&lt;...&gt;</code></p>
</blockquote>

<p><code>shell
onto_tool bundle -v user &lt;USER&gt; -v password &lt;PWD&gt;
                 -v endpoint &lt;ENDPOINT-URI&gt;
                 [ -v update_endpoint &lt;UPDATE-URI&gt; ]
                 -v report &lt;REPORT-DIR&gt; migrate_endpoint.yaml
</code></p>

</div>
</body>
</html>