<!DOCTYPE html>
<html>
<head>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
        }
        code, pre {
            font-family: monospace;
        }
        h1 code,
        h2 code,
        h3 code,
        h4 code,
        h5 code,
        h6 code {
            font-size: inherit;
        }
    </style>
</head>
<body>
<div class="container">
<h1>Migrating to gist v13.0 from v12.0</h1>

<p>This file gives a quick overview of using the migration utilities provided
by the gist team to help migrate from the previous version of gist.</p>

<blockquote>
  <p>See also additional documentation in the <a href="../../docs/MajorVersionMigration.html">Major Version Migration</a>.</p>
</blockquote>

<h2>Important Remarks</h2>

<ul>
<li><p><strong>These scripts are not cumulative; you must run the migrations for each version of gist
in sequence.</strong></p></li>
<li><p><strong>These utilities are a starting point.</strong> You should review them before running
them to make sure you approve of the actions prior to using them.</p></li>
<li><p><strong>These utilities do not handle everything</strong>, in some cases we can only warn you
about changes that were made in gist and you will need to decide how you want
to handle the changes.</p></li>
</ul>

<h2>Migration Queries</h2>

<p>All of our migration tools are SPARQL queries.</p>

<p>The following directory structure holds the migration scripts:</p>

<pre><code>.
└── queries/
    │
    ├── action/
    │   ├── default/
    │   │   └── *.rq
    │   └── ngraphs/
    │       └── *.rq
    │
    ├── report/
    │   ├── default/
    │   │   └── *.rq
    │   └── ngraphs/
    │       └── *.rq
    │
    └── uom_queries/
        └── *.rq
</code></pre>

<p>The <code>./queries/</code> directory contains the following directories:</p>

<ul>
<li><p><code>./queries/action/</code> : Update queries for migrating from Gist v12.0 to v13.0</p></li>
<li><p><code>./queries/report/</code> : Validation queries that return SHACL validation reports for data that does not comply with Gist v13.0</p></li>
<li><p><code>./queries/uom_queries/</code> : Queries for migrating to the new ontology for magnitudes, aspects, and units of measure</p></li>
</ul>

<p>The action and report directories each contain the following two directories:</p>

<ul>
<li><p><code>default/</code> : These queries only work on the default graph<code>*</code></p>

<blockquote>
  <p><code>*</code> the handling of these queries will be dependent upon which triplestore you are using and how it was configured. Some triplestores will only use
  triples in the default graph, some will use all triples in all named graphs.</p>
</blockquote></li>
<li><p><code>ngraphs/</code> : These queries only work on named graphs</p></li>
</ul>

<h2>Requirements</h2>

<p>These migration scripts are meant to be run using the open source <code>onto_tool</code>
program. Information about onto_tool and how to install it, is available at
<a href="https://pypi.org/project/onto-tool">PyPi</a>.</p>

<h2>Run on local files</h2>

<blockquote>
  <p>Note: A known limitation of <code>onto_tool</code> is that it does not support named graphs when run against local files. It does support named graphs when run against a SPARQL endpoint.</p>
</blockquote>

<ol>
<li><p>Starting in this directory, either place source data files in the <code>./input/</code> directory or point the script at the location of your data via <code>-v input</code> flag (see example below). See the onto_tool documentation for which file formats are supported.</p>

<blockquote>
  <ul>
  <li>The <code>migrate_local.yaml</code> file currently looks in the input directory for <code>*.owl</code> and <code>*.ttl</code> files. If other formats are supported and you plan to use them, you will need to update the yaml.</li>
  <li>The script will only transform RDF data files at the top level of the input directory, and will not recursively descend into sub-directories. Invoke the script multiple times with different directories specified via the <code>-v input</code> flag as needed.</li>
  </ul>
</blockquote></li>
<li><p>Execute the following command for the default <code>./input</code> director:</p>

<p><code>shell
onto_tool bundle migrate_local.yaml
</code></p>

<p>or with a custom input directory:</p>

<p><code>shell
onto_tool bundle -v input &lt;directory of RDF data&gt; migrate_local.yaml
</code></p></li>
<li><p><code>onto_tool</code> will output to STDOUT, you should see something like the following:</p>

<pre><code> INFO:root:Rename properties in named graphs.
 INFO:root:Replace address classes in named graphs.
 INFO:root:Replace properties with inverses in named graphs.
 INFO:root:Use new gist:offers property in named graphs (script 1).
 INFO:root:Use new gist:offers property in named graphs (script 2).
 INFO:root:Rename properties in named graphs.
 INFO:root:Replace address classes in named graphs.
 INFO:root:Replace properties with inverses in named graphs.
 INFO:root:Use new gist:offers property in named graphs (script 1).
 INFO:root:Use new gist:offers property in named graphs (script 2).
 INFO:root:Check the named graphs for other items that should be reviewed.
 INFO:root:Check named graphs for other items that should be reviewed.
</code></pre>

<ul>
<li><p>Output files will be created in the <code>./output/</code> directory. The location can be overriden by specifying <code>-v output &lt;existing directory for output&gt;</code>.</p></li>
<li><p>Report files will be created in the <code>./reports/</code> directory. The location can be overriden by specifying <code>-v report &lt;existing directory for report&gt;</code>.</p></li>
</ul></li>
</ol>

<h2>Run Against SPARQL Endpoint</h2>

<p>You will need to tell <code>onto_tool</code> the URL of your SPARQL endpoint. You can do that
by editing the <code>migration_endpoint.yaml</code> file, or you can put it into the command
line execution like this:</p>

<blockquote>
  <p>Note: Use your own values in place of <code>&lt;...&gt;</code></p>
</blockquote>

<p><code>shell
onto_tool bundle -v user &lt;USER&gt; -v password &lt;PWD&gt;
                 -v endpoint &lt;ENDPOINT-URI&gt;
                 [ -v update_endpoint &lt;UPDATE-URI&gt; ]
                 -v report &lt;REPORT-DIR&gt; migrate_endpoint.yaml
</code></p>

<h2>Examples</h2>

<ul>
<li>renameProperties replaces <code>gist:isGeographicallyContainedIn</code> with <code>gist:isGeoContainedIn</code></li>
<li>replaceAddressClasses replaces <code>gist:EmailAddress</code> with <code>gist:ElectronicAddress</code></li>
<li>replaceAddressClasses replaces <code>gist:StreetAddress</code> with <code>gist:PhysicalAddress</code></li>
</ul>

<p>The different types and uses of addresses can be modeled as categories; see <a href="./AddressMigration.html">the address migration documentation</a> as well as the <a href="../../docs/models/AddressGuidance.html">full documentation of the new address model</a>.</p>

<ul>
<li>replacePropertiesWithInverses replaces <code>gist:hasPart</code> with <code>gist:isPartOf</code></li>
<li>useOffersProperty (scripts 1 and 2) replaces <code>gist:hasPart</code> with <code>gist:offers</code> in the context of an offer</li>
<li>useOffersProperty (scripts 3 and 4) replaces <code>gist:isPartOf</code> with <code>gist:offers</code> in the context of an offer</li>
</ul>

<p>When converting data about offers, the offer and any sub-offer must belong to a the <code>gist:Offer</code> class or a subclass of it for the script to recognize the thing being offered.</p>

<p>The examples above are not a complete description of each script; read the scripts to see the complete list of changes they make to the data.</p>

<h2>Notes</h2>

<ul>
<li>read the scripts to see the complete list of changes they make to the data (the examples above are not comprehensive).</li>
<li>renameProperties, replaceAddressClasses, and replacePropertiesWithInverses remove classes and properties that were deprecated in release 12, i.e. they perform data conversion necessary to conform to gist 13.</li>
<li>useOffersProperty is optional for conformance with gist 13</li>
<li>be sure to update all artifacts such as data ingestion, queries, forms, documentation, etc. along with converting the data</li>
<li>for data conversion of magnitudes and units of measure, see the README file in the uom_queries directory</li>
</ul>

</div>
</body>
</html>